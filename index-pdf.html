<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz di Orientamento Universitario – TesinTesta</title>
  <style>
    :root{ --brand:#29A8E0; --ink:#222; --muted:#666; --bg:#f5f5f5; --card:#fff; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    header{background:var(--brand);padding:20px;text-align:center}
    header .logo{display:inline-block}
    main{max-width:920px;margin:24px auto;background:var(--card);padding:24px;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.06)}
    h1{margin:0 0 8px} .lead{margin:0 0 16px;color:var(--muted)}
    .grid{display:grid;gap:12px} .cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .chip{display:flex;align-items:center;gap:8px;border:1px solid #e5e7eb;padding:10px;border-radius:12px;background:#fff;cursor:pointer}
    .chip input{accent-color:var(--brand)}
    .section{margin-top:18px}
    input[type=email]{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:10px}
    button{border:0;padding:10px 16px;border-radius:10px;background:var(--brand);color:#fff;cursor:pointer}
    button.secondary{background:#111} button.ghost{background:#fff;color:var(--ink);border:1px solid #d1d5db}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;margin-top:16px}
    .note{font-size:12px;color:var(--muted)}
    .progress{height:8px;background:#e5e7eb;border-radius:999px;overflow:hidden}
    .progress>span{display:block;height:100%;background:var(--brand);width:0}
    #resultCard{display:none;margin-top:18px;border:1px solid #e5e7eb;border-radius:12px;padding:16px}
    #resultCard h2{margin:0 0 8px}
    ol{padding-left:20px}
    @media print{ header,.formOnly,.toolbar button.ghost{display:none!important} body{background:#fff} main{box-shadow:none;border:0} #resultCard{display:block} }
  </style>
</head>
<body>
  <header>
    <div class="logo" aria-label="TesinTesta logo">
      <svg xmlns="http://www.w3.org/2000/svg" width="200" height="96" viewBox="0 0 220 120">
        <rect width="220" height="120" fill="#29A8E0"/>
        <g fill="#ffffff" font-family="Arial, Helvetica, sans-serif" font-weight="700" font-size="36">
          <text x="22" y="55">TESIN-</text>
          <text x="22" y="95">TESTA</text>
        </g>
      </svg>
    </div>
  </header>

  <main>
    <h1>Scopri il tuo percorso universitario ideale</h1>
    <p class="lead">Seleziona fino a <b>8</b> attività che ti attirano. Al termine vedrai la tua Top 5 (triennali e ciclo unico) e potrai inviare il risultato via email. Copia automatica a <b>info@tesintesta.it</b>.</p>

    <div class="progress"><span id="bar"></span></div>

    <form id="quizForm" class="section">
      <h2 class="section">Attività che ti attirano</h2>
      <div class="grid cols-2" id="activities"></div>

      <div class="section formOnly">
        <label class="note">Email per ricevere il report (obbligatoria)</label>
        <input type="email" id="email" placeholder="tua@email.it" required />
      </div>

      <div class="toolbar formOnly">
        <button type="button" class="ghost" id="resetBtn">Azzera risposte</button>
        <button type="submit">Vedi risultato</button>
      </div>
      <p class="note formOnly">Nessun dato inviato a server: si usa il tuo client email. Copia automatica a info@tesintesta.it.</p>
    </form>

    <section id="resultCard" aria-live="polite">
      <h2>Il tuo risultato</h2>
      <p id="summary"></p>
      <ol id="topList"></ol>
      <div class="toolbar">
        <button type="button" id="mailBtn">Invia via email</button>
        <button type="button" id="pdfBtn">Scarica PDF</button>
        <button type="button" class="secondary" id="shareBtn">Condividi PDF</button>
        <button type="button" class="ghost" id="printBtn">Stampa</button>
        <button type="button" class="ghost" id="editBtn">Modifica risposte</button>
      </div>
      <p class="note">Per informazioni e supporto all’iscrizione: <b>www.tesintesta.it</b>.</p>
    </section>
  </main>

  <script>
    const ITEMS = [
      { t:"Assemblare o riparare un dispositivo", k:"R" },
      { t:"Sperimentare in laboratorio/ambiente", k:"R" },
      { t:"Progettare un prototipo meccanico/tecnico", k:"R" },

      { t:"Analizzare dati e trovare pattern", k:"I" },
      { t:"Studiare fenomeni naturali o algoritmi", k:"I" },
      { t:"Risolvere problemi logico‑matematici", k:"I" },

      { t:"Creare visual, layout o contenuti multimediali", k:"A" },
      { t:"Scrivere testi originali o racconti", k:"A" },
      { t:"Ideare campagne o concept creativi", k:"A" },

      { t:"Supportare persone e fare tutoraggio", k:"S" },
      { t:"Lavorare in team e mediare conflitti", k:"S" },
      { t:"Organizzare attività educative", k:"S" },

      { t:"Guidare presentazioni e decisioni", k:"E" },
      { t:"Lanciare un progetto o una start‑up", k:"E" },
      { t:"Gestire budget, obiettivi e KPI", k:"E" },

      { t:"Organizzare dati e procedure", k:"C" },
      { t:"Applicare norme e regolamenti", k:"C" },
      { t:"Curare scadenze e documenti", k:"C" }
    ];
    const LIMIT = 8;
    const SUGGESTIONS = {
      R: ["Ingegneria industriale – Energetico (L-9)", "Ingegneria civile e ambientale (L-7)"],
      I: ["Informatica e automazione – AI & Data Science (L-8)", "Scienze biologiche – Biosanitario e molecolare (L-13)"],
      A: ["Design e discipline della moda (L-3)", "Letteratura, arte, musica e spettacolo – Artistico (L-10)"],
      S: ["Scienze dell’educazione e della formazione (L-19)", "Scienze e tecniche psicologiche (L-24)"],
      E: ["Start‑Up d’impresa e modelli di business (L-33)", "Scienze della comunicazione – Digital marketing (L-20)"],
      C: ["Servizi giuridici (L-14)", "Giurisprudenza – ciclo unico (LMG/01)"]
    };

    const box = document.getElementById('activities');
    ITEMS.forEach((item, idx)=>{
      const id = 'a'+idx;
      const label = document.createElement('label');
      label.className = 'chip';
      label.innerHTML = `<input type="checkbox" id="${id}" data-k="${item.k}"><span>${item.t}</span>`;
      box.appendChild(label);
    });

    const bar = document.getElementById('bar');
    function updateProgress(){
      const n = document.querySelectorAll('#activities input:checked').length;
      bar.style.width = Math.min(100, (n/LIMIT)*100) + '%';
    }
    document.getElementById('activities').addEventListener('change', e=>{
      const checked = document.querySelectorAll('#activities input:checked').length;
      if(checked > LIMIT){ e.target.checked = false; return; }
      updateProgress();
      localStorage.setItem('tt_choices', JSON.stringify(getChoices()));
    });
    function getChoices(){ return Array.from(document.querySelectorAll('#activities input:checked')).map(i=>i.id); }
    (function restore(){
      try{
        const saved = JSON.parse(localStorage.getItem('tt_choices')||'[]');
        saved.forEach(id=>{ const el = document.getElementById(id); if(el) el.checked = true; });
        updateProgress();
        const em = localStorage.getItem('tt_email'); if(em) document.getElementById('email').value = em;
      }catch{}
    })();
    document.getElementById('resetBtn').addEventListener('click', ()=>{
      document.querySelectorAll('#activities input:checked').forEach(i=> i.checked=false);
      updateProgress(); localStorage.removeItem('tt_choices');
    });

    document.getElementById('quizForm').addEventListener('submit', function(e){
      e.preventDefault();
      const email = (document.getElementById('email').value||'').trim();
      if(!email){ alert('Inserisci una email valida.'); return; }
      localStorage.setItem('tt_email', email);

      const counts = {R:0,I:0,A:0,S:0,E:0,C:0};
      document.querySelectorAll('#activities input:checked').forEach(i=>{ counts[i.dataset.k]++; });
      const ranking = Object.entries(counts).sort((a,b)=> b[1]-a[1]);
      const top1 = ranking[0][0];
      const top2 = ranking[1] ? ranking[1][0] : null;

      const merged = [];
      if(SUGGESTIONS[top1]) merged.push(...SUGGESTIONS[top1]);
      if(top2 && SUGGESTIONS[top2]) merged.push(...SUGGESTIONS[top2]);
      const order = ['R','I','A','S','E','C'];
      for(const k of order){ if(merged.length>=5) break; if(k!==top1 && k!==top2) merged.push(SUGGESTIONS[k][0]); }
      const top5 = Array.from(new Set(merged)).slice(0,5);

      document.getElementById('summary').textContent = `Dominanti: ${top1}${top2?(' + '+top2):''}. Scelte: ${document.querySelectorAll('#activities input:checked').length}/${LIMIT}.`;
      document.getElementById('topList').innerHTML = top5.map(s=>`<li>${s}</li>`).join('');
      document.getElementById('resultCard').style.display = 'block';
      window.scrollTo({top: document.getElementById('resultCard').offsetTop - 12, behavior:'smooth'});

      window.__tt_mail_body = buildEmailBody({ top1, top2, top5, counts });
      window.__tt_mail_to = email;
    });

    function buildEmailBody({ top1, top2, top5, counts }){
      const lines = [];
      lines.push('Risultati quiz orientamento universitario');
      lines.push('Dominanti RIASEC: ' + top1 + (top2?(' + '+top2):''));
      lines.push('Punteggi: R='+counts.R+', I='+counts.I+', A='+counts.A+', S='+counts.S+', E='+counts.E+', C='+counts.C);
      lines.push('');
      lines.push('Top 5 corsi consigliati:');
      top5.forEach((t,i)=> lines.push(`${i+1}. ${t}`));
      lines.push('');
      lines.push('Nota: indicazioni orientative.');
      lines.push('Per l’iscrizione e la procedura pratica puoi rivolgerti a TesinTesta: www.tesintesta.it');
      return lines.join('\\n');
    }

    document.getElementById('mailBtn').addEventListener('click', ()=>{
      const to = encodeURIComponent(window.__tt_mail_to || '');
      if(!to){ alert('Inserisci una email e genera prima il risultato.'); return; }
      const subject = encodeURIComponent('Risultati quiz orientamento universitario');
      const body = encodeURIComponent(window.__tt_mail_body || '');
      const cc = encodeURIComponent('info@tesintesta.it');
      const mailto = `mailto:${to}?subject=${subject}&body=${body}&cc=${cc}`;
      window.location.href = mailto;
    });
    document.getElementById('printBtn').addEventListener('click', ()=>{ window.print(); });
    document.getElementById('editBtn').addEventListener('click', ()=>{
      document.getElementById('resultCard').style.display = 'none';
      window.scrollTo({top:0, behavior:'smooth'});
    });
  </script>

  <!-- jsPDF for PDF generation -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script>
    // PDF & Share
    async function generatePDF() {
      const { jsPDF } = window.jspdf || {};
      if (!jsPDF) { alert('PDF non disponibile. Usa Stampa.'); return null; }
      const doc = new jsPDF({ unit: 'pt', format: 'a4' });
      const W = 595.28, H = 841.89, M = 40;

      doc.setFillColor(41,168,224);
      doc.rect(0, 0, W, 120, 'F');
      doc.setTextColor(255,255,255);
      doc.setFont('helvetica','bold'); doc.setFontSize(22);
      doc.text('Report Quiz di Orientamento Universitario', M, 60);
      doc.setFontSize(12); doc.text('TESIN-TESTA · tesintesta.it', M, 86);

      doc.setFont('helvetica','normal'); doc.setTextColor(33,33,33); doc.setFontSize(12);
      let y = 150;
      const summary = document.getElementById('summary')?.textContent || '';
      doc.text('Sintesi:', M, y); y += 18;
      doc.text(summary, M, y, { maxWidth: W - 2*M }); y += 28;

      doc.setFont('helvetica','bold'); doc.text('Top 5 corsi consigliati', M, y); y += 16;
      doc.setFont('helvetica','normal');
      const items = Array.from(document.querySelectorAll('#topList li')).map(li=>li.textContent.trim());
      items.forEach((t, i) => { doc.text(`${i+1}. ${t}`, M, y); y += 16; });

      y += 24; doc.setFont('helvetica','normal'); doc.setTextColor(80);
      doc.text('Indicazioni orientative. Per supporto iscrizione: www.tesintesta.it', M, y);
      return doc;
    }

    document.getElementById('pdfBtn').addEventListener('click', async () => {
      const doc = await generatePDF(); if (!doc) return;
      doc.save('Report_orientamento.pdf');
    });

    document.getElementById('shareBtn').addEventListener('click', async () => {
      const doc = await generatePDF(); if (!doc) return;
      const blob = doc.output('blob');
      const file = new File([blob], 'Report_orientamento.pdf', { type: 'application/pdf' });
      try {
        if (navigator.canShare && navigator.canShare({ files: [file] })) {
          await navigator.share({ files: [file], title: 'Report Quiz TesinTesta', text: 'Ti invio il mio report del quiz.' });
        } else {
          const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'Report_orientamento.pdf'; a.click();
          alert('PDF scaricato. Allegalo manualmente alla tua email.');
        }
      } catch (e) {
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'Report_orientamento.pdf'; a.click();
      }
    });
  </script>
</body>
</html>
